name: Build Mac App

on:
  push:
    branches: [ "main" ]

jobs:
  build:
    runs-on: macos-latest  # "맥북 환경에서 실행해라"

    steps:
    - uses: actions/checkout@v3

    - name: Set up Python 3.10
      uses: actions/setup-python@v3
      with:
        python-version: "3.10"

    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install pandas beautifulsoup4 lxml playwright pyinstaller
        # Playwright 브라우저 의존성 때문에 설치 필요 (실행파일엔 포함 안 함, 사용자가 설치)
        playwright install chromium

    - name: Build with PyInstaller
      run: |
        # --windowed: 맥에서 터미널 없이 앱처럼 실행되게 함
        # --icon: 아이콘 설정 (옵션)
        pyinstaller --onefile --windowed --name "SmartStoreScraper" smartstore_gui.py

    - name: Create Zip Archive
      run: |
        cd dist
        # .app 폴더를 zip으로 압축 (맥은 .app이 폴더 구조임)
        zip -r SmartStoreScraper_Mac.zip SmartStoreScraper.app

    - name: Upload Artifact
      uses: actions/upload-artifact@v4
      with:
        name: Mac-App-Download-Here
        path: dist/SmartStoreScraper_Mac.zip
